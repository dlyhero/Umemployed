{% extends "resume/base.html" %}
{% load crispy_forms_tags %}
{% load custom_filters %}

{% block content %}

<main class="mx-auto w-[90%] max-w-[650px] mb-2">
    <section class="">
        <div class="border bg-white rounded">
            <div class="flex justify-between p-4 mb-4 border-b ">
                <p class="font-bold text-2xl text-[#1e90ff]">Edit Information</p>
            </div>
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="message {{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
            <form class="p-4" method="post" enctype="multipart/form-data" id="contact-info-form">
                {% csrf_token %}
                <div class="input-wrap mb-1">
                    <label for="{{ form.name.id_for_label }}" class="text-gray-500">Name</label>
                    {{ form.name|add_class:"border w-full mx-auto rounded p-1 focus:outline outline-1 outline-[#1e90ff]" }}
                </div>
                <div class="input-wrap mb-2">
                    <label for="{{ form.email.id_for_label }}" class="text-gray-500">Email</label>
                    {{ form.email|add_class:"border w-full mx-auto rounded p-1 focus:outline outline-1 outline-[#1e90ff]" }}
                </div>
                <div class="input-wrap mb-2">
                    <label for="{{ form.phone.id_for_label }}" class="text-gray-500">Phone</label>
                    {{ form.phone|add_class:"border w-full mx-auto rounded p-1 focus:outline outline-1 outline-[#1e90ff]" }}
                </div>
                <div class="input-wrap mb-2">
                    <label for="{{ form.country.id_for_label }}" class="text-gray-500">Country</label>
                    {{ form.country|add_class:"border w-full mx-auto rounded p-1 focus:outline outline-1 outline-[#1e90ff]" }}
                </div>
                <div class="input-wrap mb-2">
                    <label for="{{ form.job_title.id_for_label }}" class="text-gray-500">Job Title</label>
                    {{ form.job_title|add_class:"border w-full mx-auto rounded p-1 focus:outline outline-1 outline-[#1e90ff]" }}
                </div>
                <div class="input-wrap mb-2">
                    <label for="other-job-title" class="text-gray-500">Other Job Title</label>
                    <input type="text" id="other-job-title" name="other_job_title" class="border w-full mx-auto rounded p-1 focus:outline outline-1 outline-[#1e90ff]" />
                </div>
                <div class="p-4 flex justify-between border-t">
                    <div></div>
                    <button type="submit" id="save-info-btn" class="border bg-[#1e90ff] rounded-full text-white font-bold px-3 py-1">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </section>
</main>

<!-- Loader HTML -->
<div id="loader" class="hidden fixed inset-0 bg-gray-200 bg-opacity-75 flex items-center justify-center z-50">
    <div class="loader"></div>
    <h1>This might take a while, we are processing the job you entered!(^_^)</h1>
</div>

<!-- Loader CSS -->
<style>
    .loader {
        border: 8px solid #f3f3f3;
        border-radius: 50%;
        border-top: 8px solid #3498db;
        width: 60px;
        height: 60px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .hidden {
        display: none;
    }
</style>

<!-- JavaScript for handling form submission and loader -->
<script>
document.getElementById('contact-info-form').addEventListener('submit', function(event) {
    var otherJobTitle = document.getElementById('other-job-title').value;
    if (otherJobTitle) {
        event.preventDefault();
        document.getElementById('loader').classList.remove('hidden');  // Show loader
        fetch(`{{ api_url }}?input_str=${otherJobTitle}`)
            .then(response => {
                document.getElementById('loader').classList.add('hidden');  // Hide loader
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Network response was not ok');
            })
            .then(data => {
                alert(`The job title "${otherJobTitle}" has been added. Please select it from the list and click save.`);
                location.reload();
            })
            .catch(error => {
                document.getElementById('loader').classList.add('hidden');  // Hide loader
                alert('There was a problem with the request.');
                console.error('There was a problem with the fetch operation:', error);
            });
    }
});
</script>

{% endblock content %}




